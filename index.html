;

    <!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>VERANO Operations Console - v3</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body {
    margin:0;
    font-family: Arial, sans-serif;
    background:#1e1f22;
    color:#e4e6eb;
}

header {
    padding:15px;
    font-size:22px;
    font-weight:bold;
    background:#111;
    text-align:center;
    letter-spacing:1px;
}

.container {
    padding:15px;
}

.status-banner {
    padding:10px;
    text-align:center;
    font-weight:bold;
    margin-bottom:10px;
    border-radius:6px;
}

.status-normal { background:#2b2d31; }
.status-emergency { background:#7a1f1f; }

.controls button {
    margin:5px 5px 5px 0;
    padding:8px 12px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    background:#3a3b3f;
    color:white;
}

.controls button:hover {
    background:#505155;
}

.metrics {
    margin-top:15px;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
    gap:10px;
}

.metric {
    background:#2b2d31;
    padding:10px;
    border-radius:6px;
    text-align:center;
}

.timeline {
    margin-top:15px;
    background:#2b2d31;
    padding:10px;
    border-radius:6px;
    max-height:300px;
    overflow-y:auto;
    font-size:14px;
}

.timeline-entry {
    margin-bottom:4px;
}

input[type=number] {
    width:80px;
    padding:5px;
}
</style>
</head>
<body>

<header>VERANO â€“ Operations Console (v3)</header>

<div class="container">

<div id="statusBanner" class="status-banner status-normal">
Shift Inactive
</div>

<div class="controls">
<button onclick="startShift()">Start Shift</button>
<button onclick="endShift()">End Shift</button>
<button onclick="toggleBreak()">Start Break</button>
<button onclick="setStatus('Maintenance')">Maintenance</button>
<button onclick="setStatus('Training')">Training</button>
<button onclick="setStatus('Meeting')">Meeting</button>
<button onclick="setStatus('Routine')">Routine</button>
<button onclick="triggerEmergency()">ðŸš¨ Emergency</button>
</div>

<div style="margin-top:10px;">
Pods: <input type="number" id="podsInput" value="0">
<button onclick="addPods()">Add</button>
</div>

<div class="metrics">
<div class="metric">Total Pods<br><span id="totalPods">0</span></div>
<div class="metric">Worked Time<br><span id="workedTime">0h 0m</span></div>
<div class="metric">Break Time<br><span id="breakTime">0m</span></div>
<div class="metric">Pods / Hour<br><span id="podsPerHour">0</span></div>
</div>

<div class="timeline" id="timeline"></div>

</div>

<script>

let shiftActive=false;
let shiftStart=null;
let breakActive=false;
let breakStart=null;
let totalBreakMs=0;
let currentStatus=null;
let statusStart=null;
let totalPods=0;
let emergencyActive=false;
let events=[];
function saveState() {
    const state = {
        shiftActive,
        shiftStart,
        breakActive,
        breakStart,
        totalBreakMs,
        currentStatus,
        statusStart,
        totalPods,
        emergencyActive,
        timeline: document.getElementById("timeline").innerHTML
    };
    localStorage.setItem("veranoConsoleState", JSON.stringify(state));
}

function loadState() {
    const saved = localStorage.getItem("veranoConsoleState");
    if (!saved) return;

    const state = JSON.parse(saved);

    shiftActive = state.shiftActive;
    shiftStart = state.shiftStart ? new Date(state.shiftStart) : null;
    breakActive = state.breakActive;
    breakStart = state.breakStart ? new Date(state.breakStart) : null;
    totalBreakMs = state.totalBreakMs;
    currentStatus = state.currentStatus;
    statusStart = state.statusStart ? new Date(state.statusStart) : null;
    totalPods = state.totalPods;
    emergencyActive = state.emergencyActive;

    document.getElementById("timeline").innerHTML = state.timeline;
    document.getElementById("totalPods").textContent = totalPods;

    if (shiftActive) {
        document.getElementById("statusBanner").textContent = "Shift Active";
    }
}
function now() {
    return new Date();
}

function formatTime(date) {
    return date.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
}

function addTimeline(text) {
    let div=document.createElement("div");
    div.className="timeline-entry";
    div.textContent=text;
    document.getElementById("timeline").appendChild(div);
    let tl=document.getElementById("timeline");
    tl.scrollTop=tl.scrollHeight;
}

function startShift(){
    alert("StartShift function is running");
}

function endShift(){

    if(!shiftActive) return;

    if (!confirm("Are you sure you want to end this shift?")) {
    return;
}

    if(currentStatus) closeStatus();
    if(breakActive) toggleBreak();

    let end = now();
    addTimeline(formatTime(end)+" - Shift Ended");

    generatePDF();

    // ---- FULL RESET ----
    shiftActive = false;
    shiftStart = null;
    breakActive = false;
    breakStart = null;
    totalBreakMs = 0;
    currentStatus = null;

    document.getElementById("timeline").innerHTML = "";
    document.getElementById("statusBanner").textContent = "No Active Shift";

    localStorage.removeItem("veranoConsoleState");
location.reload();
}
}

function toggleBreak(){
    if(!shiftActive) return;
    if(!breakActive){
        breakActive=true;
        breakStart=now();
        addTimeline(formatTime(breakStart)+" - Break Started");
        document.querySelector("button[onclick='toggleBreak()']").textContent="End Break";
    } else {
        let end=now();
        totalBreakMs += end - breakStart;
        addTimeline(formatTime(end)+" - Break Ended ("+msToMinutes(end-breakStart)+"m)");
        breakActive=false;
        document.querySelector("button[onclick='toggleBreak()']").textContent="Start Break";
    }

    saveState();
}

function setStatus(status){
    if(!shiftActive) return;

    // If something is active, close it first
    if(currentStatus) closeStatus();

    // If Routine selected, reset everything properly
    if(status === 'Routine'){
        emergencyActive = false;
        currentStatus = null;

        const banner = document.getElementById("statusBanner");
        banner.className = "status-banner status-normal";
        banner.textContent = "Shift Active";

        saveState();

        return;
    }

    // Prevent other statuses during active emergency
    if(emergencyActive && status !== 'Routine') return;

    currentStatus = status;
    statusStart = now();

    addTimeline(formatTime(statusStart) + " - " + status + " Started");

    saveState();
}

function closeStatus(){
    let end=now();
    addTimeline(formatTime(end)+" - "+currentStatus+" Ended ("+msToMinutes(end-statusStart)+"m)");
    currentStatus=null;

    saveState();
}

function triggerEmergency(){
    if(!shiftActive) return;
    if(currentStatus) closeStatus();
    emergencyActive=true;
    currentStatus="Emergency";
    statusStart=now();
    document.getElementById("statusBanner").className="status-banner status-emergency";
    document.getElementById("statusBanner").textContent="ðŸš¨ EMERGENCY ACTIVE";
    addTimeline(formatTime(statusStart)+" - Emergency Started");

    saveState();
}

function addPods(){
    let val=parseInt(document.getElementById("podsInput").value)||0;
    totalPods+=val;
    document.getElementById("totalPods").textContent=totalPods;
    document.getElementById("podsInput").value=0;

    saveState();
}

function msToMinutes(ms){
    return Math.round(ms/60000);
}

function updateMetrics(){
    if(!shiftActive) return;
    let nowTime=now();
    let workedMs=(nowTime-shiftStart)-totalBreakMs;
    let hours=workedMs/3600000;
    document.getElementById("workedTime").textContent=
        Math.floor(workedMs/3600000)+"h "+Math.floor((workedMs%3600000)/60000)+"m";
    document.getElementById("breakTime").textContent=Math.round(totalBreakMs/60000)+"m";
    document.getElementById("podsPerHour").textContent=
        hours>0?(totalPods/hours).toFixed(2):0;
}
loadState();
setInterval(updateMetrics,10000);

function generatePDF(){
    const { jsPDF } = window.jspdf;
    let doc = new jsPDF();

    let y = 15;

    // ===== HEADER =====
    doc.setFontSize(18);
    doc.text("VERANO â€“ Operations Report", 10, y);
    y += 10;

    doc.setFontSize(10);
    let date = new Date().toLocaleString();
    doc.text("Generated: " + date, 10, y);
    y += 10;

    // ===== SHIFT SUMMARY =====
    doc.setFontSize(12);
    doc.text("Shift Summary", 10, y);
    y += 6;

    doc.setFontSize(10);

    doc.text("Total Pods: " + totalPods, 10, y);
    y += 6;

    let hours = shiftActive 
        ? ((now() - shiftStart - totalBreakMs)/3600000)
        : 0;

    doc.text("Pods Per Hour: " + (hours > 0 ? (totalPods/hours).toFixed(2) : "0"), 10, y);
    y += 6;

    doc.text("Total Break Time (min): " + Math.floor(totalBreakMs/60000), 10, y);
    y += 10;

    // ===== TIMELINE =====
    doc.setFontSize(12);
    doc.text("Activity Timeline", 10, y);
    y += 8;

    doc.setFontSize(9);

    let lines = document
        .getElementById("timeline")
        .innerText
        .split("\n");

    lines.forEach(line => {

        if(y > 280){ // page break protection
            doc.addPage();
            y = 15;
        }

        doc.text(line, 10, y);
        y += 5;
    });

    // ===== SAVE FILE =====
    let cleanDate = new Date().toISOString().slice(0,10);
    doc.save("VERANO_Shift_Report_" + cleanDate + ".pdf");
}

</script>

   <div id="versionLabel" style="
position:fixed;
bottom:8px;
right:12px;
font-size:12px;
color:#888;
opacity:0.7;
">
v0.9 â€“ 30 Day Field Test
</div> 
    
</body>

</html>








